kind: Parameterizer
apiVersion: kubernetes.sh/v1alpha1
metadata:
  name: install-ghost
spec:
  resources:
  - name: helm-chart
    source:
      urls:
        - https://github.com/kubernetes/charts/tree/master/stable/ghost
    volume:
    - name: helm-chart
      hostPath:
        path: /tmp/
  - name: local-kinflate
    source:
      hostPath: ./resources/
    volume:
    - name: kinflate
  userInputs:
  - name: helm-user-values
    source:
       hostPath:
         path: ./values/prod
    volume:
      name: helm-user-values
  volumes:
  - name: helm-output
    emptyDir: {medium: ""}
  apply:
  - image: lachlanevenson/k8s-helm:v2.7.2
    commands:
    -  helm template charts -f /helm-values/value.yaml -o /output/ghost-resources.yaml
    volumeMounts:
    - name: helm-output
      mountPath: /output
    - name: helm-chart
      mountPath: /charts
    - name: helm-user-values
      mountPath: /helm-values
  - image: ant31/kinflate
    commands:
    - bash -c 'cp /output/*.yaml" /kinflate/resources/all-resource.yaml" && kinflate inflate -f /kinflate'
    volumeMounts:
    - name: helm-output
      mountPath: /output
    - name: local-kinflate
      mountPath: /kinflate
